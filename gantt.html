<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capacity Planner Netberry - Modo Gantt</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/mode_styles.css">
</head>
<body>
    <!-- Alert Banner (condicional) -->
    <div class="alert-banner" id="alertBanner">
        üö® ATENCI√ìN: DevOps al 94.7% de capacidad - Acci√≥n requerida
    </div>

    <!-- üéØ HEADER LIMPIO Y FUNCIONAL -->
    <div class="header gantt-mode smart-header">
        <div class="header-content-smart">
            <!-- Logo y navegaci√≥n -->
            <div class="header-brand">
                <button class="back-home-icon" onclick="goHome()" title="Volver al inicio">üè†</button>
                <h1>Netberry</h1>
            </div>
            
            <!-- Indicadores Health + Alerts -->
            <div class="header-indicators">
                <div class="health-compact">
                    <span class="health-number-compact" id="healthCompact">87</span>
                    <span class="health-label-compact">Health</span>
                </div>
                <div class="alerts-compact">
                    <span class="alerts-number-compact" id="alertsCompact">3</span>
                    <span class="alerts-label-compact">Cr√≠ticas</span>
                </div>
            </div>
            
            <!-- KPIs compactos inline -->
            <div class="kpi-header-compact" id="kpiHeaderCompact">
                <!-- KPIs se cargan din√°micamente -->
            </div>
            
            <!-- Selector de modos -->
            <div class="mode-selector">
                <button class="current-mode-btn" onclick="toggleModeMenu()">
                    <span class="mode-icon">üìä</span>
                    <span class="mode-name">Modo Gantt</span>
                    <span class="mode-arrow">‚ñº</span>
                </button>
                <div class="mode-menu" id="modeMenu">
                    <div class="mode-option active" data-mode="gantt">
                        <span class="mode-icon">üìä</span>
                        <span>Modo Gantt</span>
                        <span class="check">‚úì</span>
                    </div>
                    <div class="mode-option" data-mode="projects" onclick="switchMode('projects')">
                        <span class="mode-icon">üìã</span>
                        <span>Modo Proyectos</span>
                    </div>
                    <div class="mode-option" data-mode="simulator" onclick="switchMode('simulator')">
                        <span class="mode-icon">‚ö°</span>
                        <span>Modo Simulador</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- üéØ DASHBOARD MAXIMIZADO - GANTT PROTAGONISTA -->
    <div class="dashboard-maximized">
        <!-- Gantt Chart Fusionado -->
        <div class="gantt-container-maximized">
            <div class="gantt-header-compact">
                <div class="gantt-title">
                    üìÖ Timeline de Capacidad y Proyectos
                    <span class="live-status">üü¢ LIVE</span>
                </div>
                
                <!-- üéØ FILTROS INTELIGENTES JUSTO DEBAJO DEL T√çTULO -->
                <div class="smart-filters" id="smartFilters">
                    <div class="filter-section">
                        <div class="filter-label">üîç Departamentos:</div>
                        <div class="department-selector" id="departmentSelector">
                            <button class="selector-toggle" onclick="toggleDepartmentDropdown()" id="selectorToggle">
                                <span id="selectedCount">Todos (8)</span>
                                <span class="arrow">‚ñº</span>
                            </button>
                            <div class="selector-dropdown" id="selectorDropdown">
                                <div class="dropdown-header">
                                    <button class="select-all-btn" onclick="selectAllDepartments()">‚úì Todos</button>
                                    <button class="clear-all-btn" onclick="clearAllDepartments()">‚úó Ninguno</button>
                                </div>
                                <div class="dropdown-options">
                                    <label class="option-item">
                                        <input type="checkbox" value="php" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">PHP</span>
                                        <span class="dept-count">(3p)</span>
                                        <span class="dept-status critical">87%</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" value="dotnet" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">.NET</span>
                                        <span class="dept-count">(3p)</span>
                                        <span class="dept-status critical">92%</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" value="devops" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">DevOps</span>
                                        <span class="dept-count">(2p)</span>
                                        <span class="dept-status critical">95%</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" value="movilidad" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">Movilidad</span>
                                        <span class="dept-count">(3p)</span>
                                        <span class="dept-status warning">85%</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" value="ux" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">UX-UI</span>
                                        <span class="dept-count">(2p)</span>
                                        <span class="dept-status good">74%</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" value="pmo" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">PMO</span>
                                        <span class="dept-count">(2p)</span>
                                        <span class="dept-status good">68%</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" value="marketing" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">Marketing</span>
                                        <span class="dept-count">(2p)</span>
                                        <span class="dept-status good">52%</span>
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" value="qa" checked>
                                        <span class="checkmark">‚úì</span>
                                        <span class="dept-name">QA</span>
                                        <span class="dept-count">(2p)</span>
                                        <span class="dept-status good">65%</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="quick-filters">
                            <button class="quick-filter-btn" onclick="showCriticalOnly()">üî¥ Cr√≠ticos</button>
                            <button class="quick-filter-btn" onclick="showAvailable()">üü¢ Disponibles</button>
                            <button class="quick-filter-btn active" onclick="showAll()">üìä Todos</button>
                        </div>
                    </div>
                </div>
                
                <div class="gantt-actions">
                    <button class="gantt-action-btn" onclick="openSimulator()">üéØ Simulador</button>
                    <button class="gantt-action-btn" onclick="exportGanttPDF()">üìÑ Exportar</button>
                    <button class="gantt-action-btn" onclick="togglePredictions()">üîÆ Predicciones</button>
                    <button class="gantt-action-btn" onclick="fullscreenGantt()">‚õ∂ Pantalla Completa</button>
                </div>
            </div>
            
            <div class="gantt-chart" id="ganttChart">
                <!-- El Gantt fusionado se genera din√°micamente -->
            </div>
            
            <div class="gantt-legend-compact" id="ganttLegend">
                <!-- Leyenda compacta -->
            </div>
        </div>

        <!-- AI Recommendations - Compactas al pie -->
        <div class="ai-recommendations-footer" id="aiRecommendations">
            <div class="recommendations-header-compact">
                <h3>ü§ñ Recomendaciones Inteligentes</h3>
                <div class="ai-confidence-compact">Confianza: 94%</div>
            </div>
            <div class="recommendations-carousel" id="recommendationsCarousel">
                <!-- Recomendaciones se cargan din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Modales mantenidos -->
    <div id="departmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="NetberryModal.close()">&times;</span>
                <h2 id="modalTitle">Detalle del Departamento</h2>
                <p id="modalSubtitle">Vista detallada de recursos</p>
            </div>
            <div class="modal-body">
                <div class="stats-grid" id="modalStats"></div>
                <h3>üë• Equipo y Asignaciones</h3>
                <div class="people-grid" id="peopleGrid"></div>
            </div>
        </div>
    </div>

    <div id="simulatorModal" class="modal">
        <div class="modal-content simulator-modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="NetberryComponents.simulator.closeModal()">&times;</span>
                <h2>üéØ Simulador de Impacto de Proyectos</h2>
                <p>Eval√∫a la viabilidad y el impacto de nuevos proyectos</p>
            </div>
            <div class="modal-body">
                <div id="simulatorModalContent"></div>
            </div>
        </div>
    </div>

    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close-modal" onclick="GanttChart.closeProjectModal()">&times;</span>
                <h2 id="projectModalTitle">Detalles del Proyecto</h2>
                <p id="projectModalSubtitle">Informaci√≥n del proyecto</p>
            </div>
            <div class="modal-body">
                <div id="projectModalContent"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/gantt/gantt_chart.js"></script>
    <script src="js/simulator/simulator_domino.js"></script>
    <script src="js/components_main.js"></script>
    <script src="js/gantt/gantt_controller.js"></script>

    <script>
        // Variables globales
        let selectedDepartments = ['php', 'dotnet', 'devops', 'movilidad', 'ux', 'pmo', 'marketing', 'qa'];

        // Funciones del dropdown de departamentos
        function toggleDepartmentDropdown() {
            const dropdown = document.getElementById('selectorDropdown');
            dropdown.classList.toggle('show');
        }

        function selectAllDepartments() {
            const checkboxes = document.querySelectorAll('#selectorDropdown input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
            selectedDepartments = Array.from(checkboxes).map(cb => cb.value);
            updateSelectorDisplay();
        }

        function clearAllDepartments() {
            const checkboxes = document.querySelectorAll('#selectorDropdown input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            selectedDepartments = [];
            updateSelectorDisplay();
        }

        function updateSelectorDisplay() {
            const toggle = document.getElementById('selectedCount');
            const count = selectedDepartments.length;
            
            if (count === 0) {
                toggle.textContent = 'Ninguno';
            } else if (count === 8) {
                toggle.textContent = 'Todos (8)';
            } else {
                toggle.textContent = `${count} seleccionados`;
            }
            
            // Actualizar checkmarks visuales
            document.querySelectorAll('.option-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const checkmark = item.querySelector('.checkmark');
                if (checkbox.checked) {
                    item.classList.add('selected');
                    checkmark.style.opacity = '1';
                } else {
                    item.classList.remove('selected');
                    checkmark.style.opacity = '0';
                }
            });
        }

        function toggleModeMenu() {
            document.getElementById('modeMenu').classList.toggle('show');
        }

        function switchMode(mode) {
            const modes = {
                'projects': 'projects.html',
                'simulator': 'simulator.html',
                'gantt': 'gantt.html'
            };
            
            if (modes[mode]) {
                window.location.href = modes[mode];
            }
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        function showCriticalOnly() {
            // Filtrar solo cr√≠ticos (>85%)
            const criticalDepts = ['php', 'dotnet', 'devops'];
            updateQuickFilter('critical', criticalDepts);
        }

        function showAvailable() {
            // Filtrar solo disponibles (<75%)
            const availableDepts = ['ux', 'pmo', 'marketing'];
            updateQuickFilter('available', availableDepts);
        }

        function showAll() {
            // Mostrar todos
            const allDepts = ['php', 'dotnet', 'devops', 'movilidad', 'ux', 'pmo', 'marketing', 'qa'];
            updateQuickFilter('all', allDepts);
        }

        function updateQuickFilter(type, deptList) {
            // Actualizar checkboxes
            document.querySelectorAll('#selectorDropdown input[type="checkbox"]').forEach(cb => {
                cb.checked = deptList.includes(cb.value);
            });
            
            selectedDepartments = deptList;
            updateSelectorDisplay();
            
            // Actualizar botones quick filter
            document.querySelectorAll('.quick-filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Aplicar filtros
            applyFilters();
        }

        function applyFilters() {
            // Aqu√≠ se aplicar√≠an los filtros al Gantt
            console.log('Aplicando filtros:', selectedDepartments);
            
            // Llamar a la funci√≥n de actualizaci√≥n del dashboard si existe
            if (typeof NetberryComponents !== 'undefined') {
                NetberryComponents.updateAll();
            }
        }

        function openSimulator() {
            if (typeof NetberryComponents !== 'undefined' && NetberryComponents.simulator) {
                NetberryComponents.simulator.openModal();
            }
        }

        function exportGanttPDF() {
            console.log('Exportando Gantt a PDF');
        }

        function togglePredictions() {
            console.log('Toggle predictions');
        }

        function fullscreenGantt() {
            const ganttContainer = document.querySelector('.gantt-container-maximized');
            if (ganttContainer.requestFullscreen) {
                ganttContainer.requestFullscreen();
            }
        }

        // Event listeners
        document.addEventListener('click', function(e) {
            // Cerrar dropdown de departamentos si se hace click fuera
            if (!e.target.closest('.department-selector')) {
                document.getElementById('selectorDropdown').classList.remove('show');
            }
            
            // Cerrar menu de modos si se hace click fuera
            if (!e.target.closest('.mode-selector')) {
                document.getElementById('modeMenu').classList.remove('show');
            }
        });

        // Manejar clicks en checkboxes de departamentos
        document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox' && e.target.closest('#selectorDropdown')) {
                const value = e.target.value;
                if (e.target.checked) {
                    if (!selectedDepartments.includes(value)) {
                        selectedDepartments.push(value);
                    }
                } else {
                    selectedDepartments = selectedDepartments.filter(dept => dept !== value);
                }
                updateSelectorDisplay();
                applyFilters();
            }
        });

        // Auto-inicializar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (typeof GanttMode !== 'undefined') {
                    GanttMode.init();
                } else if (typeof NetberryComponents !== 'undefined') {
                    NetberryComponents.init();
                }
                
                // Inicializar display del selector
                updateSelectorDisplay();
            }, 100);
        });
    </script>
</body>
</html>